/*!
 * TNotify, ios7+ style alert confirm and prompt service for angular
 * Author: Treri
 * License: MIT
 * Version: 1.0.1
 */
angular.module("TNotify",[]).directive("tNotify",function(){return{restrict:"E",replace:!0,scope:!0,template:'<div class="tnotify-overlay"><div class="tnotify"><div class="tnotify-inner" ng-class="{remind: type === \'remind\'}"><div class="tnotify-title" ng-if="title">{{ title }}</div><div class="tnotify-text" ng-if="text">{{ text }}</div><input type="{{ inputType }}" placeholder="{{ inputPlaceHolder }}" class="tnotify-text-input" ng-if="type === \'prompt\'" ng-model="form.input"></div><div class="tnotify-buttons" ng-if="type !== \'remind\'"><span class="tnotify-button" ng-if="type !== \'alert\'" ng-click="onCancel()">{{ cancelText }}</span><span class="tnotify-button tnotify-button-bold" ng-click="onOk(input)">{{ okText }}</span></div></div></div>'}}).factory("transition",["$window",function(a){var b=a.document.createElement("div"),c={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",transition:"transitionend"},d={WebkitTransition:"webkitAnimationEnd",MozTransition:"animationend",OTransition:"oAnimationEnd",transition:"animationend"},e=function(a){for(var c in a)if(void 0!==b.style[c])return a[c]};return{transitionEndEventName:e(c),animationEndEventName:e(d)}}]).provider("TNotify",function(){var a={title:null,text:null,form:{input:""},inputType:"text",inputPlaceHolder:"",cancelText:"取消",okText:"确定"},b=["title","text","cancelText","okText","inputType","inputPlaceHolder"];this.set=function(c,d){var e=this;if(angular.isObject(c))for(var f in c)e.set(f,c[f]);else c&&b.indexOf(c)>-1&&d&&(a[c]=d)},this.$get=["$rootScope","$compile","$animate","$q","$document","$timeout","transition",function(b,c,d,e,f,g,h){function i(i){var j,k,l,m="tnotify-in",n="tnotify-out",o="tnotify-animate",p="tnotifyEnd";return j=e.defer(),h.transitionEndEventName=h.transitionEndEventName||p,k=b.$new(!0),angular.extend(k,a,i),l=c("<t-notify></t-notify>")(k),k.onCancel=function(){"confirm"===k.type?j.resolve(!1):"prompt"===k.type&&(j.resolve(null),k.form.input=""),k.$destroy()},k.onOk=function(){"prompt"===k.type?(j.resolve(k.form.input||""),k.form.input=""):j.resolve(!0),k.$destroy()},d.enter(l,angular.element(f[0].body),angular.element(f[0].body.lastChild)).then(function(){k.$on("$destroy",function(){l.one(h.transitionEndEventName,function(){l.remove()}),l.addClass(n),h.transitionEndEventName===p&&l.triggerHandler(p)}),l.addClass(o).addClass(m),"remind"===k.type&&(h.transitionEndEventName===p?g(k.onOk,650):l.one(h.transitionEndEventName,function(){g(k.onOk,250)}))}),j.promise}function j(a){if(angular.isString(a))return{text:a};if(angular.isObject(a))return a;throw new Error("expect a string or a object")}function k(a){return a=j(a),a.type="alert",i(a)}function l(a){return a=j(a),a.type="confirm",i(a)}function m(a){return a=j(a),a.type="prompt",i(a)}function n(a){return a=j(a),a.type="remind",i(a)}return{alert:k,confirm:l,prompt:m,remind:n}}]});