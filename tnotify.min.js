/*!
 * TNotify, ios7+ style alert confirm and prompt service for angular
 * Author: Treri
 * License: MIT
 * Version: 1.0.1
 */
angular.module("TNotify",[]).directive("tNotify",function(){return{restrict:"E",replace:!0,scope:!0,template:'<div class="tnotify-overlay"><div class="tnotify"><div class="tnotify-inner" ng-class="{remind: type === \'remind\'}"><div class="tnotify-title" ng-if="title">{{ title }}</div><div class="tnotify-text" ng-if="text" ng-bind-html="renderHtml(text)"></div><input type="{{ inputType }}" placeholder="{{ inputPlaceHolder }}" class="tnotify-text-input" ng-if="type === \'prompt\'" ng-model="form.input"></div><div class="tnotify-buttons" ng-if="type !== \'remind\'"><span class="tnotify-button" ng-if="type !== \'alert\'" ng-click="onCancel()">{{ cancelText }}</span><span class="tnotify-button tnotify-button-bold" ng-click="onOk(input)">{{ okText }}</span></div></div></div>'}}).factory("transition",["$window",function(a){var b=a.document.createElement("div"),c={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",transition:"transitionend"},d={WebkitTransition:"webkitAnimationEnd",MozTransition:"animationend",OTransition:"oAnimationEnd",transition:"animationend"},e=function(a){for(var c in a)if(void 0!==b.style[c])return a[c]};return{transitionEndEventName:e(c),animationEndEventName:e(d)}}]).provider("TNotify",function(){var a={title:null,text:null,form:{input:""},inputType:"text",inputPlaceHolder:"",cancelText:"取消",okText:"确定"},b=["title","text","cancelText","okText","inputType","inputPlaceHolder"];this.set=function(c,d){var e=this;if(angular.isObject(c))for(var f in c)e.set(f,c[f]);else c&&b.indexOf(c)>-1&&d&&(a[c]=d)},this.$get=["$sce","$rootScope","$compile","$animate","$q","$document","$timeout","transition",function(b,c,d,e,f,g,h,i){function j(j){var k,l,m,n="tnotify-in",o="tnotify-out",p="tnotify-animate",q="tnotifyEnd";return k=f.defer(),i.transitionEndEventName=i.transitionEndEventName||q,l=c.$new(!0),angular.extend(l,a,j),m=d("<t-notify></t-notify>")(l),l.renderHtml=function(a){return b.trustAsHtml(a)},l.onCancel=function(){"confirm"===l.type?k.resolve(!1):"prompt"===l.type&&(k.resolve(null),l.form.input=""),l.$destroy()},l.onOk=function(){"prompt"===l.type?(k.resolve(l.form.input||""),l.form.input=""):k.resolve(!0),l.$destroy()},e.enter(m,angular.element(g[0].body),angular.element(g[0].body.lastChild)).then(function(){l.$on("$destroy",function(){m.one(i.transitionEndEventName,function(){m.remove()}),m.addClass(o),i.transitionEndEventName===q&&m.triggerHandler(q)}),m.addClass(p).addClass(n),"remind"===l.type&&(i.transitionEndEventName===q?h(l.onOk,650):m.one(i.transitionEndEventName,function(){h(l.onOk,250)}))}),k.promise}function k(a){if(angular.isString(a))return{text:a};if(angular.isObject(a))return a;throw new Error("expect a string or a object")}function l(a){return a=k(a),a.type="alert",j(a)}function m(a){return a=k(a),a.type="confirm",j(a)}function n(a){return a=k(a),a.type="prompt",j(a)}function o(a){return a=k(a),a.type="remind",j(a)}return{alert:l,confirm:m,prompt:n,remind:o}}]});